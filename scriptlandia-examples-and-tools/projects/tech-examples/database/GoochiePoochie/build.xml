<project name="HelloWorld" default="compile" basedir=".">
  <!-- Name of project and version -->
  <property name="proj.name" value="goopoo"/>
  <property name="proj.version" value="1.0"/>

  <!-- Global properties for this build -->
  <property name="src.dir" value="src/main/java"/>
  <property name="build.dir" value="target/classes"/>

  <!-- Useful shortcuts -->
  <patternset id="meta.files">
    <include name="**/*.xml"/>
    <include name="**/*.properties"/>
  </patternset>

  <!-- Clean up -->
  <target name="clean">
    <delete dir="${build.dir}"/>
  </target>

  <target name="init">
    <script language="beanshell">
      import org.sf.scriptlandia.MavenHelper;

      MavenHelper.resolveMavenDependencies(project, "pom.xml", "compile");
    </script>

    <mkdir dir="${build.dir}"/>

    <!-- Classpath declaration -->
    <path id="project.classpath">
      <path refid="maven.compile.classpath"/>

      <fileset dir="${build.dir}"/>
    </path>

    <taskdef name="hibernatetool"
             classname="org.hibernate.tool.ant.HibernateToolTask"
             classpathref="project.classpath"/>
  </target>

  <!-- Compile Java source -->
  <target name="compile" depends="init">
    <mkdir dir="${build.dir}"/>

    <javac srcdir="${src.dir}" destdir="${build.dir}" nowarn="on">
      <classpath refid="project.classpath"/>
    </javac>
  </target>

  <!-- Copy metadata to build classpath -->
  <target name="copymetafiles">
    <copy todir="${build.dir}">
      <fileset dir="${src.java.dir}">
        <patternset refid="meta.files"/>
      </fileset>
    </copy>
  </target>

  <!-- Run HelloWorld -->
  <target name="run" depends="compile, copymetafiles"
          description="Build and run HelloWorld">
    <java fork="true"
          classname="hello.HelloWorld"
          classpathref="project.classpath">
      <classpath path="${build.dir}"/>
    </java>
  </target>

  <target name="dbmanager" description="Start HSQLDB manager">
    <java classname="org.hsqldb.util.DatabaseManagerSwing" fork="yes"
          classpathref="project.classpath" failonerror="true">
      <arg value="-url"/>
      <arg value="jdbc:hsqldb:hsql://localhost/"/>
      <arg value="-driver"/>
      <arg value="org.hsqldb.jdbcDriver"/>
    </java>
  </target>

  <target name="schemaexport" depends="compile, copymetafiles"
          description="Exports a generated schema to DB and file">
    <hibernatetool destdir="target">
      <classpath path="${build.dir}"/>
      <configuration configurationfile="${build.dir}/hibernate.cfg.xml"/>

      <hbm2ddl drop="true" create="true" export="true" outputfilename="test-ddl.sql"
               delimiter=";" format="true"/>
    </hibernatetool>
  </target>

  <target name="reveng.hbmxml" depends="init"
          description="Produces XML mapping files in src directory">
    <hibernatetool destdir="${src.dir}">
      <jdbcconfiguration
        propertyfile="src/main/filters/jdbc.properties"
        revengfile="reveng.xml"/>
      <hbm2hbmxml/> <!-- Export Hibernate XML files -->
      <hbm2cfgxml/> <!-- Export a hibernate.cfg.xml file -->
    </hibernatetool>
  </target>

  <target name="reveng.pojos" depends="init"
          description="Produces Java classes from XML mappings">
    <hibernatetool destdir="target/src-generated">
      <configuration>
        <fileset dir="${src.dir}">
          <include name="**/*.hbm.xml"/>
        </fileset>
      </configuration>

      <hbm2java/> <!-- Generate entity class source -->
    </hibernatetool>
  </target>
</project>

