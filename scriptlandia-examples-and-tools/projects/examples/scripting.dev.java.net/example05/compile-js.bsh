// compile-js.bsh 

sourceRelative("../load-libraries.bsh");

import javax.script.*;

Map m = new HashMap();

ScriptEngineManager manager = new ScriptEngineManager();
ScriptEngine engine = manager.getEngineByName("js");

CompiledScript script = m.get("fib");
if(script == null) {
	Compilable compilingEngine = (Compilable)engine;
	script = compilingEngine.compile(
			"fib(num);" +
			"function fib(n) {" +
			"  if(n <= 1) return n; " +
			"  return fib(n-1) + fib(n-2); " +
			"};"		
	);
	m.put("fib", script);
}

Bindings bindings = engine.createBindings();
bindings.put("num", "20");

Object result = script.eval(bindings);

System.out.println(result);